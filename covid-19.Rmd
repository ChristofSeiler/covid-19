---
title: "COVID-19"
author: "Christof Seiler"
date: "March 8, 2020"
output: 
  html_document:
    number_sections: true
    toc: true
    toc_float: true
    theme: spacelab
    highlight: pygments
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, fig.height=4, fig.width=8)
library("tidyverse")
library("magrittr")
library("lubridate")
library("ggthemes")
```

# Data

Load GitHub data package.

```{r warning=FALSE, message=FALSE}
devtools::install_github("RamiKrispin/coronavirus")
library("coronavirus")
```

This repository is updated daily. The data frame is in variable `coronavirus`.

```{r}
data("coronavirus")
head(coronavirus)
tail(coronavirus)
```

Summary.

```{r}
coronavirus %>% 
  group_by(Country.Region, type) %>%
  summarize(total_cases = sum(cases)) %>%
  arrange(-total_cases)
```

# Visualize Development

Here are the daily development of the following 5 nations:

* China in the province Hubei
* South Korea
* Italy
* Switzerland
* The Netherlands

Also some comparisons between the Netherlands and other countries.

## Hubei Province in China

```{r}
plot_daily = function(df) {
  ggplot(df, aes(date, cases, color = type)) + 
    geom_point() +
    geom_line() + 
    facet_wrap(~Province.State) + 
    scale_x_date(date_minor_breaks = "1 day", 
                 date_breaks = "1 week", 
                 date_labels = "%b %d") + 
    scale_color_few()
}
df_china = coronavirus %>% filter(
  Country.Region == "Mainland China",
  Province.State == "Hubei"
  )
plot_daily(df_china) + ggtitle("Mainland China")
```

## South Korea

```{r}
df_south_korea = coronavirus %>% filter(Country.Region == "South Korea")
plot_daily(df_south_korea) + ggtitle("South Korea")
```

## Italy

```{r}
df_italy = coronavirus %>% filter(Country.Region == "Italy")
plot_daily(df_italy) + ggtitle("Italy")
```

## Switzerland

```{r}
df_switzerland = coronavirus %>% filter(Country.Region == "Switzerland")
plot_daily(df_switzerland) + 
  ggtitle("Switzerland") +
   scale_x_date(date_minor_breaks = "1 day", 
                 date_breaks = "2 day", 
                 date_labels = "%b %d")
```

## The Netherlands

```{r}
df_switzerland = coronavirus %>% filter(Country.Region == "Netherlands")
plot_daily(df_switzerland) + 
  ggtitle("Netherlands") +
   scale_x_date(date_minor_breaks = "1 day", 
                 date_breaks = "2 day", 
                 date_labels = "%b %d")
```

## Compare to Neighbors

Compare daily developments to our neighboring countries.

```{r}
plot_compare = function(df) {
  ggplot(df, aes(date, cases, color = Country.Region)) + 
    geom_point() +
    geom_line() + 
    scale_x_date(date_minor_breaks = "1 day", 
                 date_breaks = "1 week", 
                 date_labels = "%b %d") +
    scale_color_few()
}
neighbors = c("Netherlands", "Belgium", "Germany", "Luxembourg")
df_neighbors = coronavirus %>% filter(
  Country.Region %in% neighbors & type == "confirmed"
  )
plot_compare(df_neighbors)
```

## Compare to Italy

Compare the Netherlands to Italy.

```{r}
neighbors = c("Netherlands", "Italy")
df_neighbors = coronavirus %>% filter(
  Country.Region %in% neighbors & type == "confirmed"
  )
plot_compare(df_neighbors)
```

## Compare to Switzerland

Compare the Netherlands to Italy.

```{r}
neighbors = c("Netherlands", "Switzerland")
df_neighbors = coronavirus %>% filter(
  Country.Region %in% neighbors & type == "confirmed"
  )
plot_compare(df_neighbors) +
  scale_x_date(date_minor_breaks = "1 day", 
                 date_breaks = "2 day", 
                 date_labels = "%b %d")
```

# Visualize Align Countries

Align time series with respect to days from first confirmed case in respective country. 

* First, find patient zero for each country.
* Second, plot aligned number of cases to compare the relative progress between country.

## Patient Zero for Each Country

```{r}
df = coronavirus
df_patient_zero = df %>% 
  group_by(Country.Region) %>%
  arrange(ymd(date)) %>%
  summarize(patient_zero = min(date)) %>% 
  arrange()
head(df_patient_zero)
tail(df_patient_zero)
# add patient zero information to coronavirus data frame
df %<>% left_join(df_patient_zero, by = "Country.Region")
df %<>% 
  group_by(Country.Region) %>%
  mutate(
  duration = interval(ymd(patient_zero), ymd(date)) %>% as.numeric("days")
  ) %>% 
  ungroup()
```

## Plot with Aligned Time Series

```{r}
countries = c("Netherlands", "Belgium", "Germany",
              "Luxembourg", "Italy", "Switzerland", 
              "South Korea")
df_countries = df %>% filter(
  Country.Region %in% countries & type == "confirmed"
  )
ggplot(df_countries, 
       aes(duration, cases, color = Country.Region)) + 
  geom_point() +
  geom_line() + 
  scale_x_continuous(breaks = seq(1, nrow(df_countries), 2)) +
  xlab("days since patient zero") +
  scale_color_few()
```

# Session Info {.unnumbered}

```{r}
sessionInfo()
```
